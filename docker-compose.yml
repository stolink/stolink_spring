version: "3.8"

services:
  # Spring Boot Application
  backend:
    image: ${IMAGE_NAME}
    container_name: stolink-backend
    environment:
      # Spring Profile
      SPRING_PROFILES_ACTIVE: dev
      # PostgreSQL
      POSTGRESQL_URL: ${POSTGRESQL_URL}
      POSTGRESQL_PORT: ${POSTGRESQL_PORT}
      POSTGRESQL_USERNAME: ${POSTGRESQL_USERNAME}
      POSTGRESQL_PASSWORD: ${POSTGRESQL_PASSWORD}
      # Neo4j
      NEO4J_URI: ${NEO4J_URI}
      NEO4J_USERNAME: ${NEO4J_USERNAME}
      NEO4J_PASSWORD: ${NEO4J_PASSWORD}
      NEO4J_PORT: ${NEO4J_PORT}
      # RabbitMQ
      RABBITMQ_IMAGE_HOST: ${RABBITMQ_IMAGE_HOST}
      RABBITMQ_IMAGE_PORT: ${RABBITMQ_IMAGE_PORT}
      RABBITMQ_IMAGE_VHOST: ${RABBITMQ_IMAGE_VHOST}
      RABBITMQ_IMAGE_USER: ${RABBITMQ_IMAGE_USER}
      RABBITMQ_IMAGE_PASSWORD: ${RABBITMQ_IMAGE_PASSWORD}
      # AI Callback URL
      APP_AI_CALLBACK_BASE_URL: ${APP_AI_CALLBACK_BASE_URL}
      # Storage path
      APP_STORAGE_BASE_PATH: /app/storage/uploads
      # CORS
      CORS_ALLOWED_ORIGINS: ${CORS_ALLOWED_ORIGINS:-http://localhost:3000,http://localhost:5173,http://localhost:5174}
    ports:
      - "8080:8080"
    volumes:
      - backend_storage:/app/storage/uploads
    networks:
      - stolink-network
    restart: unless-stopped

volumes:
  backend_storage:

networks:
  stolink-network:
    driver: bridge
