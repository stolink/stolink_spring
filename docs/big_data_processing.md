# StoLink AI Backend - ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë¬¸ì„œ

> **Last Updated**: 2026-01-01

---

## í˜„ì¬ ì‹œìŠ¤í…œ êµ¬ì¡° (Current Architecture)

### ğŸ“… ë‚ ì§œ
2026-01-01

### ğŸ¯ í˜„ì¬ ì‹œìŠ¤í…œ ê°œìš”
**ë‹¨ì¼ í…ìŠ¤íŠ¸ ë¶„ì„** ì¤‘ì‹¬ì˜ Multi-Agent LangGraph íŒŒì´í”„ë¼ì¸

---

## 1ï¸âƒ£ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (Current)

### ì „ì²´ íë¦„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        í˜„ì¬ ì‹œìŠ¤í…œ ë°ì´í„° íë¦„                             â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Spring Bootâ”‚â”€â”€â”€â”€â–¶â”‚  RabbitMQ   â”‚â”€â”€â”€â”€â–¶â”‚ Python Workerâ”‚                â”‚
â”‚  â”‚  (Publisher)â”‚     â”‚   Queue     â”‚     â”‚  (Consumer)  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                 â”‚                        â”‚
â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                                    â”‚   LangGraph Pipeline   â”‚            â”‚
â”‚                                    â”‚   (Multi-Agent System) â”‚            â”‚
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                 â”‚                        â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                      â”‚              Callback to Spring Boot            â”‚ â”‚
â”‚                      â”‚   POST /api/ai-callback/{jobId}/analysis-result â”‚ â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚                        â”‚
â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                                    â”‚  PostgreSQL + Neo4j    â”‚            â”‚
â”‚                                    â”‚    (Data Persistence)  â”‚            â”‚
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë©”ì‹œì§€ ìŠ¤í‚¤ë§ˆ (RabbitMQ)
```json
{
  "job_id": "story-001",
  "project_id": "proj-001", 
  "document_id": "doc-001",
  "callback_url": "http://spring-backend:8080/api/ai-callback",
  "content": "ì „ì²´ ìŠ¤í† ë¦¬ í…ìŠ¤íŠ¸... (ë‹¨ì¼ ë¬¸ì„œ)",
  "context": {
    "existing_characters": [{"id": "char-001", "name": "ì´ì•ˆ", "role": "protagonist"}],
    "existing_events": [{"id": "evt-001", "event_type": "ENCOUNTER", "summary": "..."}],
    "existing_relationships": [...],
    "existing_settings": [...]
  },
  "trace_id": "req-20260101-abc123"
}
```

---

## 2ï¸âƒ£ LangGraph íŒŒì´í”„ë¼ì¸ êµ¬ì¡°

### Supervisor íŒ¨í„´ (Main Graph)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Main Analysis Graph                         â”‚
â”‚                                                                 â”‚
â”‚   START â”€â”€â–¶ Supervisor â”€â”€â”¬â”€â”€â–¶ Extraction â”€â”€â–¶ Supervisor         â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â”œâ”€â”€â–¶ Analysis â”€â”€â–¶ Supervisor           â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â”œâ”€â”€â–¶ Validation â”€â”€â–¶ Supervisor         â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â””â”€â”€â–¶ END (ë˜ëŠ” ì¬ì‹œë„ ë£¨í”„)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Extraction ë…¸ë“œ ìƒì„¸
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Extraction Node (2-Phase)                    â”‚
â”‚                                                                 â”‚
â”‚   Phase 1: Master Data (ë³‘ë ¬)                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚  Character Team   â”‚    â”‚   Setting Agent   â”‚               â”‚
â”‚   â”‚  (Hierarchical)   â”‚    â”‚                   â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚            â”‚                         â”‚                          â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                         â–¼                                       â”‚
â”‚   Phase 2: Narrative Flow (ìˆœì°¨)                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚              Event Agent                   â”‚                â”‚
â”‚   â”‚  (Character + Setting ê²°ê³¼ ì°¸ì¡°)           â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Character Team (Hierarchical Multi-Agent)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Character Team Graph                         â”‚
â”‚                                                                 â”‚
â”‚   char_supervisor â”€â”€â–¶ identity â”€â”€â–¶ char_supervisor              â”‚
â”‚                                                                 â”‚
â”‚                  â”€â”€â–¶ parallel_batch â”€â”€â–¶ char_supervisor         â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                        â”‚ appearance   (ë³‘ë ¬ ì‹¤í–‰)     â”‚           â”‚
â”‚                        â”‚ personality                â”‚           â”‚
â”‚                        â”‚ relations                  â”‚           â”‚
â”‚                        â”‚ dialogue_mood              â”‚           â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚                  â”€â”€â–¶ aggregator â”€â”€â–¶ END                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Analysis ë…¸ë“œ (ë³‘ë ¬)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Analysis Node (ë³‘ë ¬)                        â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚ Relationship â”‚  â”‚ Consistency  â”‚  â”‚    Plot      â”‚         â”‚
â”‚   â”‚   Analyzer   â”‚  â”‚   Checker    â”‚  â”‚  Integrator  â”‚         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚          â”‚                 â”‚                 â”‚                  â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                            â–¼                                    â”‚
â”‚                    asyncio.gather()                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3ï¸âƒ£ ì—ì´ì „íŠ¸ ëª©ë¡ ë° ì—­í• 

### Extraction Agents (ë°ì´í„° ì¶”ì¶œ)

| ì—ì´ì „íŠ¸ | íŒŒì¼ | ì—­í•  |
|----------|------|------|
| **Character Team** | `extraction/character/supervisor.py` | ìºë¦­í„° ì •ë³´ ì¶”ì¶œ ì´ê´„ |
| â”œâ”€ Identity | `extraction/character/identity.py` | ì´ë¦„, ì—­í• , ë³„ì¹­, ìƒíƒœ |
| â”œâ”€ Appearance | `extraction/character/appearance.py` | ì™¸ëª¨, ë³µì¥, ì•„íŠ¸ ìŠ¤íƒ€ì¼ |
| â”œâ”€ Personality | `extraction/character/personality.py` | ì„±ê²©, ê°€ì¹˜ê´€, ê²°ì  |
| â”œâ”€ Relations | `extraction/character/relations.py` | ìºë¦­í„° ê°„ ê´€ê³„ ê·¸ë˜í”„ |
| â”œâ”€ Dialogue/Mood | `extraction/character/dialogue_mood.py` | ëŒ€í™” íŒ¨í„´, í˜„ì¬ ê°ì • |
| â””â”€ Aggregator | `extraction/character/aggregator.py` | ì„œë¸Œì—ì´ì „íŠ¸ ê²°ê³¼ ë³‘í•© |
| **Setting Agent** | `extraction/setting.py` | ë°°ê²½, ì¥ì†Œ, ë¶„ìœ„ê¸° |
| **Event Agent** | `extraction/event.py` | ì‚¬ê±´, íƒ€ì„ë¼ì¸, ì°¸ì—¬ì |

### Analysis Agents (ë°ì´í„° ë¶„ì„)

| ì—ì´ì „íŠ¸ | íŒŒì¼ | ì—­í•  |
|----------|------|------|
| **Relationship** | `analysis/relationship.py` | ê´€ê³„ ë„¤íŠ¸ì›Œí¬ ë¶„ì„ |
| **Consistency** | `analysis/consistency.py` | ëª¨ìˆœì  ê°ì§€ + RAG |
| **Plot** | `analysis/plot.py` | í”Œë¡¯ êµ¬ì¡° + Tension Curve |

### Validation Agent

| ì—ì´ì „íŠ¸ | íŒŒì¼ | ì—­í•  |
|----------|------|------|
| **Validator** | `validation/validator.py` | ìŠ¤í‚¤ë§ˆ ê²€ì¦ + í’ˆì§ˆ ì ìˆ˜ |

---

## 4ï¸âƒ£ ìƒíƒœ ìŠ¤í‚¤ë§ˆ (AnalysisState)

```python
class AnalysisState(TypedDict, total=False):
    # === ì…ë ¥ (ë¶ˆë³€) ===
    content: str              # ì „ì²´ ìŠ¤í† ë¦¬ í…ìŠ¤íŠ¸
    project_id: str
    document_id: str
    job_id: str
    callback_url: str
    trace_id: str             # ë¶„ì‚° ì¶”ì  ID
    
    # === ê¸°ì¡´ ë°ì´í„° (Spring Boot Context) ===
    existing_characters: list
    existing_events: list
    existing_relationships: list
    existing_settings: list
    
    # === ì¶”ì¶œ ê²°ê³¼ ===
    extracted_characters: list  # FullCharacter ìŠ¤í‚¤ë§ˆ
    extracted_events: list      # EventExtraction ìŠ¤í‚¤ë§ˆ
    extracted_settings: list    # SettingExtraction ìŠ¤í‚¤ë§ˆ
    
    # === ë¶„ì„ ê²°ê³¼ ===
    relationship_graph: dict
    consistency_report: dict
    plot: dict
    
    # === ê²€ì¦ ===
    validation_result: dict
    
    # === ì œì–´ í”Œë˜ê·¸ ===
    extraction_done: bool
    analysis_done: bool
    validation_done: bool
    retry_count: int           # ìµœëŒ€ 3íšŒ ì¬ì‹œë„
    
    # === ëˆ„ì  í•„ë“œ ===
    messages: list
    errors: list
```

---

## 5ï¸âƒ£ ì¶œë ¥ ìŠ¤í‚¤ë§ˆ (Callback Payload)

```json
{
  "job_id": "story-001",
  "status": "completed",
  "results": {
    "characters": [
      {
        "_id": "char-ì´ì•ˆ-001",
        "role": "protagonist",
        "profile": {
          "character_id": "char-ì´ì•ˆ-001",
          "name": "ì´ì•ˆ",
          "age": 28,
          "gender": "male",
          "backstory": "...",
          "faction": {"name": "ì•„í‚¤ë¹„ìŠ¤íŠ¸", "social": {...}}
        },
        "aliases": ["Ian"],
        "status": "alive",
        "appearance": {
          "physique": "athletic",
          "skin_tone": "fair",
          "eyes": "brown",
          "attire": ["ë§í† ", "ê°€ë°©"],
          "style_context": {"art_style": "Digital Illustration, Concept Art"}
        },
        "relations": {
          "graph": [
            {"target": "ì§€ì•„", "type": "FAMILY", "strength": 10, ...}
          ],
          "event_refs": ["E001", "E002"]
        },
        "current_mood": {"emotion": "ê²°ì˜", "intensity": 7, "trigger": "..."},
        "embedding": [0.123, -0.456, ...],  // 1536ì°¨ì›
        "meta": {"data_version": "2.0.0"}
      }
    ],
    "events": [...],
    "settings": [...],
    "relationship_graph": {...},
    "plot": {...},
    "consistency_report": {...},
    "validation_result": {...}
  },
  "processing_time_ms": 45000
}
```

---

## 6ï¸âƒ£ ì €ì¥ì†Œ ì—­í•  ë¶„ë¦¬ (Current)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  í˜„ì¬ ì €ì¥ì†Œ êµ¬ì¡°                       â”‚
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   PostgreSQL    â”‚    â”‚     Neo4j       â”‚          â”‚
â”‚  â”‚   (Spring Boot) â”‚    â”‚   (Spring Boot) â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚          â†‘                      â†‘                    â”‚
â”‚   - Project ë©”íƒ€ë°ì´í„°     - Character Node          â”‚
â”‚   - Job ìƒíƒœ               - Event Node              â”‚
â”‚   - ì›ë³¸ í…ìŠ¤íŠ¸ (S3 ì°¸ì¡°)   - Setting Node            â”‚
â”‚                           - Relationships           â”‚
â”‚                           - embedding (ë²¡í„° ê²€ìƒ‰)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€» FastAPIëŠ” ì“°ê¸° ê¶Œí•œ ì—†ìŒ (Callbackìœ¼ë¡œ Spring Bootì— ì „ë‹¬)
â€» FastAPIëŠ” ì½ê¸° ì „ìš© DB ì¡°íšŒ ê°€ëŠ¥ (db_query_service.py)
```

---

## 7ï¸âƒ£ í˜„ì¬ ì‹œìŠ¤í…œì˜ íŠ¹ì§• ë° í•œê³„

### âœ… ê°•ì 

| í•­ëª© | ì„¤ëª… |
|------|------|
| **Multi-Agent** | ì—­í• ë³„ ì „ë¬¸í™”ëœ ì—ì´ì „íŠ¸ |
| **Supervisor íŒ¨í„´** | ì¬ì‹œë„ ë£¨í”„ + í’ˆì§ˆ ì œì–´ |
| **Hierarchical** | Character Team ë‚´ë¶€ 2ë‹¨ê³„ ë³‘ë ¬í™” |
| **existing_* ì§€ì›** | ê¸°ì¡´ ìºë¦­í„° ID ì¬ì‚¬ìš© ê°€ëŠ¥ |
| **Embedding ìƒì„±** | ìºë¦­í„°/ì´ë²¤íŠ¸ ë²¡í„° (Neo4j ë²¡í„° ê²€ìƒ‰ìš©) |

### âš ï¸ í•œê³„

| í•­ëª© | ì„¤ëª… |
|------|------|
| **ë‹¨ì¼ ë¬¸ì„œ ì²˜ë¦¬** | ì „ì²´ í…ìŠ¤íŠ¸ë¥¼ í•œ ë²ˆì— ë¶„ì„ |
| **ë©”ëª¨ë¦¬ ì œí•œ** | ëŒ€ìš©ëŸ‰ ì†Œì„¤ (100ë§Œì+) ì²˜ë¦¬ ì–´ë ¤ì›€ |
| **ìˆœì°¨ ì²˜ë¦¬** | ì±•í„°ë³„ ë¶„í•  ë¶„ì„ ë¯¸ì§€ì› |
| **ì‹¤ì‹œê°„ í”¼ë“œë°± ì—†ìŒ** | ë¶„ì„ ì™„ë£Œê¹Œì§€ ìƒíƒœ ì•Œë¦¼ ì—†ìŒ |

6000ì ê¸°ì¤€ ì•½ 1ë¶„ 20 ~ 40ì´ˆ ê±¸ë¦¼

---

## 8ï¸âƒ£ ì£¼ìš” íŒŒì¼ êµ¬ì¡°

```
app/
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ graph.py              # Main LangGraph ì •ì˜
â”‚   â”œâ”€â”€ supervisor.py         # Supervisor ë¡œì§
â”‚   â”œâ”€â”€ state.py              # AnalysisState ì •ì˜
â”‚   â”œâ”€â”€ llm.py                # LLM ì„¤ì • (Gemini/AWS Bedrock)
â”‚   â”‚
â”‚   â”œâ”€â”€ extraction/
â”‚   â”‚   â”œâ”€â”€ character/
â”‚   â”‚   â”‚   â”œâ”€â”€ supervisor.py     # Character Team ê·¸ë˜í”„
â”‚   â”‚   â”‚   â”œâ”€â”€ identity.py
â”‚   â”‚   â”‚   â”œâ”€â”€ appearance.py
â”‚   â”‚   â”‚   â”œâ”€â”€ personality.py
â”‚   â”‚   â”‚   â”œâ”€â”€ relations.py
â”‚   â”‚   â”‚   â”œâ”€â”€ dialogue_mood.py
â”‚   â”‚   â”‚   â”œâ”€â”€ aggregator.py
â”‚   â”‚   â”‚   â””â”€â”€ state.py
â”‚   â”‚   â”œâ”€â”€ event.py
â”‚   â”‚   â””â”€â”€ setting.py
â”‚   â”‚
â”‚   â”œâ”€â”€ analysis/
â”‚   â”‚   â”œâ”€â”€ relationship.py
â”‚   â”‚   â”œâ”€â”€ consistency.py
â”‚   â”‚   â””â”€â”€ plot.py
â”‚   â”‚
â”‚   â””â”€â”€ validation/
â”‚       â””â”€â”€ validator.py
â”‚
â”œâ”€â”€ schemas/
â”‚   â”œâ”€â”€ messages.py           # RabbitMQ ë©”ì‹œì§€ ìŠ¤í‚¤ë§ˆ
â”‚   â”œâ”€â”€ characters.py         # FullCharacter ìŠ¤í‚¤ë§ˆ
â”‚   â”œâ”€â”€ events.py             # EventExtraction ìŠ¤í‚¤ë§ˆ
â”‚   â””â”€â”€ settings.py           # SettingExtraction ìŠ¤í‚¤ë§ˆ
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ rabbitmq_consumer.py  # ë©”ì‹œì§€ ìˆ˜ì‹ 
â”‚   â”œâ”€â”€ analysis_service.py   # íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
â”‚   â”œâ”€â”€ callback_client.py    # Spring Boot ì½œë°±
â”‚   â””â”€â”€ db_query_service.py   # ì½ê¸° ì „ìš© DB ì¡°íšŒ
â”‚
â””â”€â”€ config.py                 # í™˜ê²½ ì„¤ì •
```

---

---

## ì œì•ˆëœ ì•„í‚¤í…ì²˜ (Proposed Architecture)



## 1ï¸âƒ£ ì œì•ˆëœ ì›Œí¬í”Œë¡œìš° (Original Workflow)

### ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (3ë‹¨ê³„)
1. **Ingestion (Spring)**: ì›ë³¸ ì €ì¥ ë° 1ì°¨ ë¬¼ë¦¬ ë¶„í•  (ì´ˆê³ ì†)
2. **Processing (Python)**: 2ì°¨ ë…¼ë¦¬/ì˜ë¯¸ ë¶„í•  ë° AI ë¶„ì„ (ì •ë°€)
3. **Serving (Client)**: ê²°ê³¼ ì‹œê°í™” (ì§€ì—° ë¡œë”©)

### Phase 1: ì—…ë¡œë“œ ë° ì´ˆê³ ì† ì´ˆê¸°í™” (Client â†’ Spring) - **0.5ì´ˆ ëª©í‘œ**
| ë‹¨ê³„ | ì‘ì—… | ì„¤ëª… |
|------|------|------|
| 1 | íŒŒì¼ ìˆ˜ì‹  | `POST /api/projects/upload` |
| 2 | S3 ì €ì¥ | `raw/{uuid}.txt` ì¦‰ì‹œ ì—…ë¡œë“œ (Safety First) |
| 3 | Project ìƒì„± | DB `project` í…Œì´ë¸” ë ˆì½”ë“œ ìƒì„± |
| 4 | Regex ë¶„í•  | Java ì •ê·œì‹ìœ¼ë¡œ 365ê°œ ì±•í„° ë¶„í•  |
| 5 | Bulk Insert | `chapter` í…Œì´ë¸”ì— 365ê°œ ë ˆì½”ë“œ í•œ ë²ˆì— ì €ì¥ |
| 6 | ë©”ì‹œì§€ ë°œí–‰ | RabbitMQì— 365ê°œ ë©”ì‹œì§€ Fan-out |
| 7 | ì‘ë‹µ ë¦¬í„´ | `200 OK + projectId` (ì‚¬ìš©ìëŠ” ì¦‰ì‹œ ì±•í„° ëª©ë¡ í™•ì¸ ê°€ëŠ¥) |

### Phase 2: ë¹„ë™ê¸° ì •ë°€ ë¶„ì„ (RabbitMQ â†’ Python)
| ë‹¨ê³„ | ì‘ì—… | ì„¤ëª… |
|------|------|------|
| 1 | ë©”ì‹œì§€ ìˆ˜ì‹  | ì›Œì»¤(1~10)ê°€ `chapterId` ê°€ì ¸ê° |
| 2 | DB ì¡°íšŒ | `chapter` í…Œì´ë¸”ì—ì„œ content ì¡°íšŒ |
| 3 | Semantic Chunking | ë¬¸ì¥ ì„ë² ë”© â†’ ì˜ë¯¸ ë‹¨ìœ„ ë¶„í•  |
| 4 | AI ìš”ì•½ | LLMìœ¼ë¡œ `nav_title` ìƒì„± |
| 5 | ì„¹ì…˜ ì €ì¥ | `section` í…Œì´ë¸”ì— Bulk Insert |
| 6 | ìƒíƒœ ê°±ì‹  | `chapter.status = COMPLETED` |

### Phase 3: ê²°ê³¼ ì¡°íšŒ (Client â†” Spring)
- SSE/í´ë§ìœ¼ë¡œ ì±•í„° ìƒíƒœ ì‹¤ì‹œê°„ ê°±ì‹ 
- ì™„ë£Œëœ ì±•í„° í´ë¦­ ì‹œ `GET /api/chapters/{id}/sections` í˜¸ì¶œ

---

## 2ï¸âƒ£ ì‚¬ìš©ì ì§ˆë¬¸ ë° ì‹œë‹ˆì–´ ê°œë°œì ì‘ë‹µ

### Q1: RabbitMQì— contentë¥¼ ë‹´ëŠ” ê²ƒ vs DB ì¡°íšŒ?

**ì‘ë‹µ: DB ì¡°íšŒ ë°©ì‹ ì••ë„ì  ìœ ë¦¬ (Claim Check Pattern)**

| ê¸°ì¤€ | Content í¬í•¨ | IDë§Œ ì „ì†¡ |
|------|-------------|-----------|
| RabbitMQ ë¶€í•˜ | ë†’ìŒ (OOM ìœ„í—˜) | ë‚®ìŒ |
| ì¬ì‹œë„ ë¹„ìš© | ë†’ìŒ | ë‚®ìŒ (IDë§Œ ì¬ì „ì†¡) |
| ë°ì´í„° ì¼ê´€ì„± | ë©”ì‹œì§€ ì‹œì  ê³ ì • | í•­ìƒ ìµœì‹  |

**ê¶Œì¥ Flow:**
```
RabbitMQ: {"projectId": 1, "chapterId": 101}  (ê°€ë²¼ì›€)
     â†“
Python: SELECT content FROM chapter WHERE id=101
```

### Q2: ë¬¸ì¥ ì„ë² ë”© vs Neo4j í™œìš©?

**ì‘ë‹µ: í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ ì¶”ì²œ**

1. **ë¬¸ì¥ ì„ë² ë”© ê¸°ë°˜ Semantic Chunking** (Base)
   - ì•/ë’· ë¬¸ì¥ ìœ ì‚¬ë„ ê¸‰ë½ì  = ì¥ë©´ ì „í™˜ì 
   - ì‚¬ëŒì´ ëŠë¼ëŠ” "ë¬¸ë‹¨ ì „í™˜"ì„ ê¸°ê³„ì ìœ¼ë¡œ íƒì§€

2. **Neo4j ë©”íƒ€ë°ì´í„° íƒœê¹…** (Enrichment)
   - ë¶„í• ëœ Sectionì— ìºë¦­í„°/ì´ë²¤íŠ¸ í‚¤ì›Œë“œ ë§¤í•‘
   - `relates_to: ['ì² ìˆ˜', 'ì˜í¬']` íƒœê·¸ ì¶”ê°€
   - RAG ê²€ìƒ‰ ì‹œ ë©”íƒ€ë°ì´í„° í•„í„° í™œìš©

---

## 3ï¸âƒ£ ì¶”ê°€ ê³ ë ¤ì‚¬í•­ ë° ì§ˆë¬¸ (Antigravity ë¶„ì„)

### A. ì±•í„° ê°„ ìºë¦­í„° ì¼ê´€ì„± ë¬¸ì œ

**ì§ˆë¬¸**: 1ì¥ì—ì„œ ì¶”ì¶œëœ `char-ì´ì•ˆ-001`ì´ 50ì¥ì—ì„œë„ ë™ì¼ ì¸ë¬¼ë¡œ ì¸ì‹ë˜ë‚˜?

**ë¶„ì„ ê²°ê³¼**: âœ… **ì´ë¯¸ ì§€ì›ë¨**
```python
# aggregator.py (ë¼ì¸ 546-580)
existing_char = existing_lookup.get(canonical_name)
if existing_char:
    char_id = existing_char.get("id", ...)  # ID ì¬ì‚¬ìš©
```

**ì¡°ê±´**: `existing_characters`ë¡œ ì´ì „ ì±•í„° ìºë¦­í„° ì „ë‹¬ í•„ìš”

### B. ìˆœì°¨ vs ë³‘ë ¬ ì²˜ë¦¬

| ë°©ì‹ | ì¥ì  | ë‹¨ì  |
|------|------|------|
| ìˆœì°¨ ì²˜ë¦¬ | ë§¥ë½ ì •í™• | ëŠë¦¼ (180ë¶„+) |
| ë³‘ë ¬ ì²˜ë¦¬ | ë¹ ë¦„ | "ê·¸ë…€" ë“± ëŒ€ëª…ì‚¬ í•´ì„ ë¶ˆê°€ |

### C. 0.5ì´ˆ ëª©í‘œ ë‹¬ì„± ê°€ëŠ¥ì„±

**RabbitMQ ê¸°ë³¸ ì„¤ì •**: 365ê°œ ë©”ì‹œì§€ ê°œë³„ ë°œí–‰ â†’ **ë¶ˆê°€ëŠ¥**
**Batch ëª¨ë“œ í•„ìš”**: ë„¤íŠ¸ì›Œí¬ ì™•ë³µ 1íšŒë¡œ 365ê°œ ë°œí–‰ â†’ **ê°€ëŠ¥**

### D. ì‹¤ì‹œê°„ ìƒíƒœ í´ë§

**ì¶”ì²œ**: SSE + Redis Pub/Sub
- í´ë§ë³´ë‹¤ DB ë¶€í•˜ ê°ì†Œ
- WebSocketë³´ë‹¤ êµ¬í˜„ ê°„ë‹¨

### E. ì±•í„° ë¶„í•  Fallback

**ë¬¸ì œ**: ëª¨ë“  ì†Œì„¤ì´ `ì œ1ì¥`, `Chapter 1` íŒ¨í„´ì„ ë”°ë¥´ì§€ ì•ŠìŒ

### F. Section ì„ë² ë”© ì €ì¥ì†Œ

**ì§ˆë¬¸**: ìºë¦­í„°/ì´ë²¤íŠ¸ëŠ” Neo4j, Section ì„ë² ë”©ì€ ì–´ë””ì—?

---

## 4ï¸âƒ£ ì‚¬ìš©ì í›„ì† ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€

### Q1: ì±•í„°ë³„ ë¶„ì„ ì‹œ ë™ì¼ ìºë¦­í„° ì¸ì‹ í…ŒìŠ¤íŠ¸?

**ë‹µë³€**: í˜„ì¬ ì‹œìŠ¤í…œ ì´ë¯¸ `existing_characters` ê¸°ë°˜ ID ì¬ì‚¬ìš© ì§€ì›

**ì›Œí¬í”Œë¡œìš°:**
```
ì±•í„° N ë¶„ì„ ì™„ë£Œ â†’ DBì— ìºë¦­í„° ì €ì¥
     â†“
ì±•í„° N+1 ë¶„ì„ ìš”ì²­ â†’ DBì—ì„œ ê¸°ì¡´ ìºë¦­í„° ì¡°íšŒ â†’ context.existing_charactersë¡œ ì „ë‹¬
     â†“
Pythonì´ ì´ë¦„ ë§¤ì¹­ + ID ì¬ì‚¬ìš©
```

### Q2: ìºë¦­í„° ID ì¼ê´€ì„± ìœ ì§€ ì „ëµ?

**ì¶”ì²œ: ìˆœì°¨-ì¦ë¶„ ë¶„ì„**
```json
POST /api/analysis/chapter/{chapterId}
{
  "content": "ì±•í„° 50 í…ìŠ¤íŠ¸...",
  "context": {
    "existing_characters": [
      {"id": "char-ì´ì•ˆ-001", "name": "ì´ì•ˆ", "aliases": ["Ian"]}
    ]
  }
}
```

### Q3: ìˆœì°¨ vs ë³‘ë ¬?

**ì¶”ì²œ: 2-Pass í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ**

| Pass | ë°©ì‹ | ëª©ì  | ì†ë„ |
|------|------|------|------|
| 1ì°¨ | ë³‘ë ¬ (10 ì›Œì»¤) | ê¸°ë³¸ ì¶”ì¶œ | ë¹ ë¦„ (~20ë¶„) |
| 2ì°¨ | ìˆœì°¨ + ë³‘í•© | ID í†µí•©, ê´€ê³„ ì—°ê²° | ëŠë¦¼ (~5ë¶„) |

**ì´ 25ë¶„** (ìˆœì°¨ë§Œ í•  ê²½ìš° 180ë¶„+)

### Q4: 0.5ì´ˆ ë©”ì‹œì§€ ë°œí–‰?

**RabbitMQ Batch ëª¨ë“œë¡œ ê°€ëŠ¥:**
```java
rabbitTemplate.invoke(operations -> {
    for (ChapterMessage msg : messages) {
        operations.convertAndSend(EXCHANGE, ROUTING_KEY, msg);
    }
    operations.waitForConfirms(5000);
    return true;
});
```

**ë‹¤ë¥¸ MQ ë¶ˆí•„ìš”** - RabbitMQ Batchë¡œ ì¶©ë¶„

### Q5: SSE ì¶”ì²œ ì´ìœ ?

| ê¸°ì¤€ | í´ë§ | SSE | WebSocket |
|------|------|-----|-----------|
| ì„œë²„ ë¶€í•˜ | ë†’ìŒ | ë‚®ìŒ | ë‚®ìŒ |
| HTTP í˜¸í™˜ | âœ… | âœ… | âŒ |
| ì–‘ë°©í–¥ | âŒ | âŒ | âœ… |
| ë³µì¡ë„ | ì‰¬ì›€ | ë³´í†µ | ì–´ë ¤ì›€ |

**SSE ì¶”ì²œ ì´ìœ :**
1. ìƒíƒœ ì•Œë¦¼ì€ **ì„œë²„â†’í´ë¼ì´ì–¸íŠ¸ ë‹¨ë°©í–¥**ì´ë©´ ì¶©ë¶„
2. HTTP ê¸°ë°˜ìœ¼ë¡œ **í”„ë¡ì‹œ/ë¡œë“œë°¸ëŸ°ì„œ ì¹œí™”ì **
3. WebSocketë³´ë‹¤ **êµ¬í˜„ ê°„ë‹¨**

### Q6: ì±•í„° ë¶„í•  Fallback?

**Cascading Fallback ì¶”ì²œ:**
```java
public List<Chapter> splitChapters(String rawText) {
    // 1ì°¨: ëª…ì‹œì  ë§ˆì»¤ (ì œ1ì¥, Chapter 1)
    List<Chapter> chapters = splitByExplicitMarkers(rawText);
    if (!chapters.isEmpty()) return chapters;
    
    // 2ì°¨: ë¹ˆ ì¤„ + ì œëª© íŒ¨í„´ (### ë˜ëŠ” **êµµì€**)
    chapters = splitByParagraphHeaders(rawText);
    if (!chapters.isEmpty()) return chapters;
    
    // 3ì°¨: ë¹ˆ ì¤„ ê¸°ë°˜
    chapters = splitByDoubleNewline(rawText);
    if (chapters.size() >= 10) return chapters;
    
    // 4ì°¨: ê³ ì • ê¸€ì ìˆ˜ + ë¬¸ì¥ ê²½ê³„ ì¡´ì¤‘ (10,000ì)
    return splitByCharacterCount(rawText, 10000, true);
}
```

### Q7: Section ì„ë² ë”© ì €ì¥ì†Œ?

**ì¶”ì²œ: PostgreSQL + pgvector**

| ì˜µì…˜ | ì¥ì  | ë‹¨ì  |
|------|------|------|
| **PostgreSQL + pgvector** | ìš´ì˜ ë‹¨ìˆœ, ê¸°ì¡´ ì¸í”„ë¼ | 10M+ ì‹œ ì„±ëŠ¥ í•œê³„ |
| Neo4j Vector | ê·¸ë˜í”„ í†µí•© | ëŠë¦¼ |
| Qdrant | ìµœê³  ì„±ëŠ¥ | ì¶”ê°€ ì¸í”„ë¼ |

**ì—­í•  ë¶„ë¦¬:**
- **Neo4j**: ìºë¦­í„°/ì´ë²¤íŠ¸ ê´€ê³„ (ê·¸ë˜í”„ ì¿¼ë¦¬)
- **PostgreSQL(pgvector)**: Section ì„ë² ë”© (ì˜ë¯¸ ê²€ìƒ‰)

**Section í…Œì´ë¸” ì„¤ê³„:**
```sql
CREATE TABLE section (
    id BIGSERIAL PRIMARY KEY,
    chapter_id BIGINT NOT NULL,
    project_id BIGINT NOT NULL,
    nav_title VARCHAR(100),
    content TEXT NOT NULL,
    sequence_order INT NOT NULL,
    embedding vector(1536),              -- pgvector
    related_characters TEXT[],           -- Neo4j ë©”íƒ€ë°ì´í„° íƒœê¹…
    related_events TEXT[]
);

CREATE INDEX idx_section_embedding ON section 
USING ivfflat (embedding vector_cosine_ops) 
WITH (lists = 100);
```

---

## 5ï¸âƒ£ ìµœì¢… ì¶”ì²œ ìš”ì•½

### ì•„í‚¤í…ì²˜ ê²°ì •

| í•­ëª© | ì¶”ì²œ |
|------|------|
| ë©”ì‹œì§€ ì „ì†¡ | **Claim Check Pattern** (IDë§Œ ì „ì†¡, DBì—ì„œ content ì¡°íšŒ) |
| ì±•í„° ë¶„í•  | **Cascading Fallback** (ëª…ì‹œì  ë§ˆì»¤ â†’ ë¹ˆ ì¤„ â†’ ê³ ì • ê¸€ììˆ˜) |
| ì²˜ë¦¬ ë°©ì‹ | **2-Pass í•˜ì´ë¸Œë¦¬ë“œ** (ë³‘ë ¬ ì¶”ì¶œ â†’ ê¸€ë¡œë²Œ ë³‘í•©) |
| ë©”ì‹œì§€ í | **RabbitMQ Batch ëª¨ë“œ** (ë³€ê²½ ë¶ˆí•„ìš”) |
| ìƒíƒœ í´ë§ | **SSE + Redis Pub/Sub** |
| ì„ë² ë”© ì €ì¥ | **PostgreSQL + pgvector** (Section) / **Neo4j** (Character/Event) |

### ìµœì¢… ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 1: Ingestion (Spring) - 0.5ì´ˆ ëª©í‘œ                         â”‚
â”‚                                                                 â”‚
â”‚  Client â†’ Spring â†’ S3 (ì›ë³¸) + PostgreSQL (chapters) + RabbitMQ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 2: Processing (Python) - ë¹„ë™ê¸°                            â”‚
â”‚                                                                 â”‚
â”‚  1ì°¨ Pass (ë³‘ë ¬): 10 ì›Œì»¤ Ã— 365 ì±•í„° â†’ ê¸°ë³¸ ì¶”ì¶œ (~20ë¶„)          â”‚
â”‚  2ì°¨ Pass (ìˆœì°¨): ID í†µí•© + ê´€ê³„ ì—°ê²° + ëª¨ìˆœ ê°ì§€ (~5ë¶„)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 3: Serving (Client)                                       â”‚
â”‚                                                                 â”‚
â”‚  SSEë¡œ ìƒíƒœ ìˆ˜ì‹  â†’ ì™„ë£Œëœ ì±•í„° í´ë¦­ â†’ Section í…ìŠ¤íŠ¸ + ë©”íƒ€ë°ì´í„° â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì €ì¥ì†Œ ì—­í•  ë¶„ë¦¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì €ì¥ì†Œ ì—­í•  ë¶„ë¦¬                     â”‚
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   PostgreSQL    â”‚    â”‚     Neo4j       â”‚          â”‚
â”‚  â”‚   + pgvector    â”‚    â”‚                 â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚          â†‘                      â†‘                    â”‚
â”‚   - project, chapter      - Character Node          â”‚
â”‚   - section + embedding   - Event Node              â”‚
â”‚   - ì˜ë¯¸ ê²€ìƒ‰ (RAG)        - Relationships          â”‚
â”‚                           - ê·¸ë˜í”„ ì¿¼ë¦¬              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ“ ê´€ë ¨ íŒŒì¼ (í–¥í›„ êµ¬í˜„ ì‹œ)
- `app/agents/extraction/character/aggregator.py` - existing_characters í™œìš© ë¡œì§
- `app/services/section_service.py` - ì‹ ê·œ (Section ì €ì¥ + ì„ë² ë”©)
- `app/services/chunking_service.py` - ì‹ ê·œ (Semantic Chunking)
- Spring Boot: `ChapterSplitService.java`, `RabbitMQBatchPublisher.java`

---

---

## 6ï¸âƒ£ ì‹œë‹ˆì–´ ê°œë°œì í”¼ë“œë°± (Critical Success Factors)

### ğŸ“… ë‚ ì§œ
2026-01-01

---

### CSF 1: Ingestion ë‹¨ê³„ íŠ¸ëœì­ì…˜ ë³´ì¥

**ë¬¸ì œ**: DB Insertì™€ RabbitMQ ë°œí–‰ì˜ ì›ìì„± ë¯¸ë³´ì¥ ì‹œ ì±•í„° ë¶„ì„ ëˆ„ë½

**ì˜µì…˜ ë¹„êµ**:

| ë°©ì‹ | ì•ˆì •ì„± | ë³µì¡ë„ | 0.5ì´ˆ ë‹¬ì„± |
|------|--------|--------|------------|
| **ì§ì ‘ ë°œí–‰ + Rollback** | ì¤‘ê°„ | ë‚®ìŒ | âœ… ê°€ëŠ¥ |
| **Transactional Outbox + Scheduler** | ë†’ìŒ | ì¤‘ê°„ | âœ… ê°€ëŠ¥ |
| **Debezium CDC** | ìµœê³  | ë†’ìŒ | âš ï¸ ì¶”ê°€ ì§€ì—° |

**ì¶”ì²œ**: ì²« ë²„ì „ì€ **ì§ì ‘ ë°œí–‰ + ë³´ìƒ íŠ¸ëœì­ì…˜**ìœ¼ë¡œ ì‹œì‘

```java
// Spring Boot ì˜ˆì‹œ
@Transactional
public void processUpload(MultipartFile file) {
    Project project = projectRepository.save(...);
    List<Chapter> chapters = splitAndSave(file);
    
    try {
        rabbitTemplate.invoke(ops -> {
            chapters.forEach(ch -> ops.convertAndSend(...));
            ops.waitForConfirms(3000);
            return null;
        });
    } catch (Exception e) {
        project.setStatus("UPLOAD_FAILED");  // ë³´ìƒ íŠ¸ëœì­ì…˜
        throw e;
    }
}
```

**ì¶”ê°€ ì œì–¸**:
- S3 ì—…ë¡œë“œ ì‹œ **InputStream Pass-through** (ë©”ëª¨ë¦¬ ë²„í¼ë§ ë°©ì§€)
- MultipartFile ì„ì‹œ ë””ìŠ¤í¬ ì €ì¥ ë¹„í™œì„±í™”

---

### CSF 2: Entity Resolution (ê°œì²´ ì‹ë³„) - 2ì°¨ Pass í•µì‹¬

**ë¬¸ì œ**: ì›Œì»¤1ì˜ "ì´ì•ˆ" vs ì›Œì»¤10ì˜ "Ian" ë™ì¼ ì¸ë¬¼ íŒë³„

**í˜„ì¬ ì½”ë“œ ë¶„ì„ (`aggregator.py`)**:
- âœ… í•œê¸€-ì˜ë¬¸ ë§¤í•‘ (í•˜ë“œì½”ë”©ëœ ê²½ìš°)
- âœ… ë™ì  aliases í™œìš©
- âŒ Fuzzy Matching (ë¯¸ì§€ì›)
- âŒ Vector Similarity (ë¯¸ì§€ì›)

**ì¶”ì²œ ê°œì„ **:

```python
from rapidfuzz import fuzz

def is_same_character(name1: str, name2: str, threshold: int = 80) -> bool:
    # 1. ì •í™• ì¼ì¹˜
    if name1.lower() == name2.lower():
        return True
    
    # 2. í•œê¸€-ì˜ë¬¸ ë§¤í•‘ í…Œì´ë¸”
    if KOREAN_ENGLISH_MAPPING.get(name1) == name2:
        return True
    
    # 3. Fuzzy Matching (Levenshtein)
    if fuzz.ratio(name1, name2) >= threshold:
        return True
    
    return False
```

**Race Condition ë°©ì§€**:
- 2ì°¨ Pass íëŠ” **ë‹¨ì¼ ì›Œì»¤(prefetch=1, consumers=1)** í•„ìˆ˜
- Actor Model ì ìš© ê¶Œì¥

---

### CSF 3: Dual Write â†’ Eventual Consistency

**ë¬¸ì œ**: PostgreSQL/Neo4j ë™ì‹œ ì“°ê¸° ì‹œ Partial Failure

**í˜„ì¬ êµ¬ì¡°**: Spring Bootê°€ PG + Neo4j ë™ì‹œ ì €ì¥

**ì¶”ì²œ: Event-Driven ë¹„ë™ê¸° ë™ê¸°í™”**

```
PostgreSQL (Master) â”€â”€â–¶ Domain Event â”€â”€â–¶ Neo4j (Eventually)
```

**ì´ì **:
- Neo4j ì¥ì•  ì‹œì—ë„ ì‚¬ìš©ìëŠ” í…ìŠ¤íŠ¸ ì½ê¸° ê°€ëŠ¥
- ê·¸ë˜í”„ ì‹œê°í™”ëŠ” ì ì‹œ ì§€ì—°ë˜ì–´ë„ ë¬´ë°©

---

### ğŸš€ ë‹¤ìŒ ë‹¨ê³„ (Action Items)

| ìš°ì„ ìˆœìœ„ | ì‘ì—… | ë‹´ë‹¹ |
|----------|------|------|
| **P0** | RabbitMQ Payload í™•ì •: `{projectId, chapterId}` | Spring |
| **P0** | Fallback í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤: ë‹¤ì–‘í•œ ì±•í„° í¬ë§· ê²€ì¦ | Spring |
| **P1** | Entity Resolution ì„ê³„ê°’ ê²°ì • (ìœ ì‚¬ë„ 80%?) | Python |
| **P1** | 2ì°¨ Pass ì „ìš© í ì„¤ê³„ (ë‹¨ì¼ ì›Œì»¤) | ê³µë™ |
| **P2** | Transactional Outbox ë„ì… ê²€í†  | Spring |
| **P2** | PGâ†’Neo4j ì´ë²¤íŠ¸ ë™ê¸°í™” ì„¤ê³„ | Spring |

---

---

## 7ï¸âƒ£ í˜„ì¬ vs ì œì•ˆ ì•„í‚¤í…ì²˜ ë¹„êµ

| í•­ëª© | í˜„ì¬ (Current) | ì œì•ˆ (Proposed) |
|------|---------------|-----------------|
| **ì²˜ë¦¬ ë‹¨ìœ„** | ì „ì²´ ë¬¸ì„œ (ë‹¨ì¼) | ì±•í„°ë³„ (ë¶„í• ) |
| **ë³‘ë ¬ì„±** | ì—ì´ì „íŠ¸ ë‚´ ë³‘ë ¬ | ì±•í„° ê°„ + ì—ì´ì „íŠ¸ ë‚´ ë³‘ë ¬ |
| **ë©”ì‹œì§€ í¬ê¸°** | ì „ì²´ í…ìŠ¤íŠ¸ í¬í•¨ | IDë§Œ (Claim Check) |
| **ì‹¤ì‹œê°„ í”¼ë“œë°±** | ì—†ìŒ | SSE + Redis |
| **ì„ë² ë”© ì €ì¥** | Neo4j | PostgreSQL(pgvector) + Neo4j |
| **ì²˜ë¦¬ ì‹œê°„** | 6000ìë‹¹ 1ë¶„ 20~40ì´ˆ | 365ì±•í„° ì•½ 25ë¶„ (ì˜ˆìƒ) |
| **í™•ì¥ì„±** | ì œí•œì  | ì›Œì»¤ ìˆ˜í‰ í™•ì¥ ê°€ëŠ¥ |

---

---

## 8ï¸âƒ£ 20ë…„ì°¨ ì‹œë‹ˆì–´ í”¼ë“œë°± - Production Level ë””í…Œì¼

### ğŸ“… ë‚ ì§œ
2026-01-01

---

### âš ï¸ Pitfall 1: DB Connection Pool ê³ ê°ˆ

**ë¬¸ì œ**: `@Transactional` ë‚´ì—ì„œ RabbitMQ ëŒ€ê¸° ì‹œ DB Connection ì ìœ 

```java
// âŒ ìœ„í—˜í•œ ì½”ë“œ
@Transactional
public void processUpload(MultipartFile file) {
    projectRepository.save(project);  // DB Connection íšë“
    
    // [ìœ„í—˜] RabbitMQê°€ 3ì´ˆê°„ ì‘ë‹µ ì—†ìœ¼ë©´ DB Connectionì´ 3ì´ˆê°„ ë¬¼ë¦¼
    // íŠ¸ë˜í”½ í­ì£¼ ì‹œ Connection Pool ê³ ê°ˆ â†’ ì„œë²„ ë‹¤ìš´
    rabbitTemplate.invoke(...).waitForConfirms(3000);
}
```

**í•´ê²°: TransactionalEventListener (After Commit)**

```java
// âœ… ì•ˆì „í•œ ì½”ë“œ
@Transactional
public void processUpload(...) {
    // 1. DB ì €ì¥ (State: PENDING) - ë¹ ë¥´ê²Œ ì™„ë£Œ
    Project project = projectRepository.save(project);
    
    // 2. ë©”ëª¨ë¦¬ ì´ë²¤íŠ¸ ë°œí–‰ (íŠ¸ëœì­ì…˜ ë‚´)
    applicationEventPublisher.publishEvent(new ProjectCreatedEvent(project));
}
// â† ì—¬ê¸°ì„œ DB Connection ë°˜í™˜ë¨

// íŠ¸ëœì­ì…˜ ì™„ì „ ì¢…ë£Œ í›„ ì‹¤í–‰ë¨ (DB Connection ì´ë¯¸ ë°˜í™˜ëœ ìƒíƒœ)
@TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)
public void onProjectCreated(ProjectCreatedEvent event) {
    try {
        // 3. RabbitMQ ë°œí–‰ (ì—¬ê¸°ì„œ ì§€ì—°ë˜ì–´ë„ DB Connectionì€ ì•ˆì „)
        rabbitTemplate.invoke(...); 
    } catch (Exception e) {
        // 4. ì‹¤íŒ¨ ì‹œ ë³„ë„ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë³´ìƒ
        projectService.markAsFailed(event.getProjectId()); 
    }
}
```

**í•µì‹¬**: DB Lock ì ìœ  ì‹œê°„ ìµœì†Œí™”

---

### âš ï¸ Pitfall 2: Fuzzy Matching Threshold (False Positives)

**ë¬¸ì œ**: 80ì  thresholdëŠ” ì§§ì€ ì´ë¦„ì—ì„œ ìœ„í—˜

```
"ê¹€ì² " vs "ê¹€ì†”" â†’ í¸ì§‘ ê±°ë¦¬ìƒ ìœ ì‚¬í•˜ê²Œ ë‚˜ì˜´ (ì˜¤íƒ!)
"ì´ì•ˆ" vs "ì´ì–¸" â†’ í•œê¸€ ìëª¨(Jamo) íŠ¹ì„± ë¯¸ë°˜ì˜
```

**í•´ê²°: 3ë‹¨ê³„ ìë™í™” ì „ëµ**

| ì ìˆ˜ | ì²˜ë¦¬ ë°©ì‹ |
|------|----------|
| **95ì  ì´ìƒ** | ìë™ ë³‘í•© (í™•ì‹ ) |
| **80~94ì ** | í›„ë³´ ëª©ë¡ì— ì €ì¥ + ê´€ë¦¬ì/ì‚¬ìš©ì ê²€ì¦ |
| **80ì  ë¯¸ë§Œ** | ë³„ê°œ ìºë¦­í„°ë¡œ ì²˜ë¦¬ |

```python
def classify_match(name1: str, name2: str) -> str:
    score = fuzz.ratio(name1, name2)
    
    if score >= 95:
        return "AUTO_MERGE"
    elif score >= 80:
        return "NEEDS_REVIEW"  # UIì—ì„œ "ë™ì¼ ì¸ë¬¼ì¸ê°€ìš”?" í™•ì¸
    else:
        return "DIFFERENT"
```

**ì¶”ê°€ ë¡œê·¸ í…Œì´ë¸” (í–¥í›„ UI ê²€ì¦ìš©)**:
```sql
CREATE TABLE character_merge_candidates (
    id SERIAL PRIMARY KEY,
    project_id BIGINT,
    name1 VARCHAR(100),
    name2 VARCHAR(100),
    similarity_score INT,
    status VARCHAR(20) DEFAULT 'PENDING',  -- PENDING, MERGED, REJECTED
    reviewed_by VARCHAR(100),
    created_at TIMESTAMP DEFAULT NOW()
);
```

---

### âœ… Pitfall 3: ë©±ë“±ì„± (Idempotency) - GlobalMergerWorker

**ë¬¸ì œ**: ì›Œì»¤ ì¬ì‹œì‘ ì‹œ ë©”ì‹œì§€ ì¬ì²˜ë¦¬ â†’ ì¤‘ë³µ ë³‘í•©

**í•´ê²°: ì²˜ë¦¬ ì™„ë£Œ ì²´í¬**

```python
class GlobalMergerWorker:
    async def merge_project(self, project_id: str):
        # 1. ì´ë¯¸ ì²˜ë¦¬ëœ ë³‘í•©ì¸ì§€ í™•ì¸
        project = await db.query("SELECT status FROM project WHERE id = %s", project_id)
        
        if project.status == "MERGE_COMPLETED":
            print(f"[IDEMPOTENCY] Project {project_id} already merged, skipping")
            return  # ACK í›„ ìŠ¤í‚µ
        
        if project.status == "MERGE_IN_PROGRESS":
            # ì´ì „ ì²˜ë¦¬ê°€ ì‹¤íŒ¨í–ˆì„ ìˆ˜ ìˆìŒ - ì¬ì²˜ë¦¬ í—ˆìš©
            print(f"[RECOVERY] Resuming merge for {project_id}")
        
        # 2. ìƒíƒœë¥¼ IN_PROGRESSë¡œ ë³€ê²½
        await db.execute(
            "UPDATE project SET status = 'MERGE_IN_PROGRESS' WHERE id = %s", 
            project_id
        )
        
        # 3. ë³‘í•© ë¡œì§ ì‹¤í–‰...
        
        # 4. ì™„ë£Œ í‘œì‹œ
        await db.execute(
            "UPDATE project SET status = 'MERGE_COMPLETED' WHERE id = %s", 
            project_id
        )
```

**RabbitMQ ì„¤ì • (í•„ìˆ˜)**:
```yaml
queues:
  chapter_analysis:
    prefetch: 10
    consumers: 10
  
  global_merge:      # 2ì°¨ Pass
    prefetch: 1      # ë‹¨ì¼ ì²˜ë¦¬
    consumers: 1     # ë‹¨ì¼ ì›Œì»¤ë§Œ!
```

---

### âœ… Pitfall 4: Neo4j Decoupling - ë³„ë„ í ë¶„ë¦¬

**ë¬¸ì œ**: Neo4j ì¥ì•  ì‹œ ì „ì²´ ì‹œìŠ¤í…œ ì¤‘ë‹¨

**í•´ê²°: ë³„ë„ graph_sync_queue**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Neo4j Decoupling Architecture                  â”‚
â”‚                                                                 â”‚
â”‚   Python Worker                                                 â”‚
â”‚        â”‚                                                        â”‚
â”‚        â–¼                                                        â”‚
â”‚   Callback to Spring                                            â”‚
â”‚        â”‚                                                        â”‚
â”‚        â–¼                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚   â”‚   PostgreSQL     â”‚  â† SSOT (Single Source of Truth)        â”‚
â”‚   â”‚   (ì¦‰ì‹œ ì €ì¥)     â”‚                                         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚            â”‚                                                    â”‚
â”‚            â–¼                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚ graph_sync_queue â”‚â”€â”€â”€â”€â–¶â”‚     Neo4j        â”‚                â”‚
â”‚   â”‚   (RabbitMQ)     â”‚     â”‚  (Eventually)    â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                 â”‚
â”‚   â€» Neo4j ë‹¤ìš´ ì‹œ: íì— ë©”ì‹œì§€ ìŒ“ì„, ë³µêµ¬ í›„ ìë™ ì²˜ë¦¬           â”‚
â”‚   â€» ì‚¬ìš©ì: PG ê¸°ë°˜ í…ìŠ¤íŠ¸ ì„œë¹„ìŠ¤ëŠ” ì •ìƒ ì´ìš© ê°€ëŠ¥                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Spring Boot êµ¬í˜„**:
```java
@Service
public class AnalysisResultHandler {
    
    @Transactional
    public void handleCallback(AnalysisResult result) {
        // 1. PostgreSQL ì¦‰ì‹œ ì €ì¥ (Master)
        characterRepository.saveAll(result.getCharacters());
        eventRepository.saveAll(result.getEvents());
        
        // 2. Neo4j ë™ê¸°í™” ì´ë²¤íŠ¸ ë°œí–‰ (ë¹„ë™ê¸°)
        rabbitTemplate.convertAndSend(
            "graph_sync_queue", 
            new GraphSyncMessage(result.getProjectId(), result.getCharacters())
        );
    }
}

// ë³„ë„ Consumer (Neo4j ì¥ì• ì™€ ë¬´ê´€í•˜ê²Œ PG ì„œë¹„ìŠ¤ ìœ ì§€)
@RabbitListener(queues = "graph_sync_queue")
public void syncToNeo4j(GraphSyncMessage msg) {
    neo4jService.upsertCharacters(msg.getCharacters());
    neo4jService.upsertRelationships(msg.getRelationships());
}
```

---

### ğŸ¯ Production Readiness Checklist

| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| TransactionalEventListener íŒ¨í„´ | ğŸ”² TODO | DB Connection ê³ ê°ˆ ë°©ì§€ |
| Fuzzy Matching 3ë‹¨ê³„ ë¶„ë¥˜ | ğŸ”² TODO | ì˜¤íƒ ë°©ì§€ |
| GlobalMergerWorker ë©±ë“±ì„± | ğŸ”² TODO | ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€ |
| graph_sync_queue ë¶„ë¦¬ | ğŸ”² TODO | Neo4j Decoupling |
| RabbitMQ prefetch=1 ì„¤ì • | ğŸ”² TODO | 2ì°¨ Pass ë‹¨ì¼ ì²˜ë¦¬ |

---

---

## ğŸ“Œ ë¬¸ì„œ ë²„ì „ íˆìŠ¤í† ë¦¬

| ë²„ì „ | ë‚ ì§œ | ë³€ê²½ ë‚´ìš© |
|------|------|----------|
| 1.0 | 2026-01-01 | í˜„ì¬ ì‹œìŠ¤í…œ êµ¬ì¡° ë¬¸ì„œí™” |
| 1.1 | 2026-01-01 | ì œì•ˆ ì•„í‚¤í…ì²˜ ì¶”ê°€ |
| 1.2 | 2026-01-01 | ì‹œë‹ˆì–´ í”¼ë“œë°± (CSF 1~3) ë°˜ì˜ |
| 1.3 | 2026-01-01 | 20ë…„ì°¨ ì‹œë‹ˆì–´ í”¼ë“œë°± (Production Level ë””í…Œì¼) ë°˜ì˜ |

---
